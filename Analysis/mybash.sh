file="$1"

cd volatility3
python3 vol.py -f "$file" windows.pslist|tail -n +5|wc -l >output.txt
python3 vol.py -f "$file" windows.pslist | awk '{print $2}' | tail -n +5 | sort | uniq | wc -l>>output.txt
python3 vol.py -f "$file" windows.pslist| awk '{print $5}' |tail -n +5 | awk '{s+=$1} END {print s/NR}'>>output.txt
nh=$(python3 vol.py -f "$file" windows.handles|tail -n +5|wc -l);np=$(python3 vol.py -f "$file" windows.pslist |tail -n +5| wc -l);echo " $nh $np "|awk '{printf "%.2f\n",$1/$2}' >>output.txt
python3 vol.py -f "$file" windows.dlllist|tail -n +5|wc -l >>output.txt
np=$(python3 vol.py -f "$file" windows.pslist |tail -n +5| wc -l);dll=$(python3 vol.py -f "$file" windows.dlllist |tail -n +5| wc -l);echo " $dll $np "|awk '{printf "%.2f\n",$1/$2}' >>output.txt
python3 vol.py -f "$file" windows.handles|tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep File |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Event |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Desktop |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Key |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Thread |tail -n +5|wc -l>>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Directory |tail -n +5|wc -l>>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Semaphore |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Timer |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Section |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.handles| awk '{print $5}' |grep Mutant |tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.ldrmodules| awk '{print $4}'| grep -e "False"  | wc -l >>output.txt
python3 vol.py -f "$file" windows.ldrmodules| awk '{print $5}'| grep -e "False"  | wc -l>>output.txt
python3 vol.py -f "$file" windows.ldrmodules| awk '{print $6}'| grep -e "False"  | wc -l>>output.txt
python3 vol.py -f "$file" windows.malfind|grep ".exe"|wc -l>>output.txt
python3 vol.py -f "$file" windows.modules|awk '{print $4}'|tail -n +5|sort|uniq|wc -l>>output.txt  
mv output.txt /home/ubuntu/volatility2
cd ..
cd volatility2
profiles=($(./vol -f "$file" imageinfo | grep "Suggested Profile(s)" | awk -F " : " '{print $2}' | tr ',' '\n'))
./vol -f "$file" --profile="${profiles[0]}" psxview|awk '{print $4}'|grep 'False'|wc -l >>output.txt
./vol -f "$file" --profile="${profiles[0]}" psxview|awk '{print $2}'|grep '*'|wc -l >>output.txt
./vol -f "$file" --profile="${profiles[0]}" psxview|awk '{print $6}'|grep 'False'|wc -l >>output.txt
./vol -f "$file" --profile="${profiles[0]}" psxview|awk '{print $7}'|grep 'False'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" psxview|awk '{print $8}'|grep 'False'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" psxview|awk '{print $9}'|grep 'False'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" psxview|awk '{print $10}'|grep "False"|wc -l>>output.txt
np=$(./vol -f "$file" --profile="${profiles[0]}" psxview |awk '{print $4}'|grep 'True'|wc -l);dll=$(./vol -f "$file" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>output.txt
np=$(./vol -f "$file" --profile="${profiles[0]}" psxview |awk '{print $2}'|grep -v '*'|wc -l);dll=$(./vol -f "$file" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>output.txt
np=$(./vol -f "$file" --profile="${profiles[0]}" psxview |awk '{print $6}'|grep 'True'|wc -l);dll=$(./vol -f "$file" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>output.txt
np=$(./vol -f "$file" --profile="${profiles[0]}" psxview |awk '{print $7}'|grep 'True'|wc -l);dll=$(./vol -f "$file" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>output.txt
np=$(./vol -f "$file" --profile="${profiles[0]}" psxview |awk '{print $8}'|grep 'True'|wc -l);dll=$(./vol -f "$file" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>output.txt
np=$(./vol -f "$file" --profile="${profiles[0]}" psxview |awk '{print $9}'|grep 'True'|wc -l);dll=$(./vol -f "$file" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>output.txt
np=$(./vol -f "$file" --profile="${profiles[0]}" psxview |awk '{print $10}'|grep 'True'|wc -l);dll=$(./vol -f "$file" --profile="${profiles[0]}" psxview |tail -n +3|wc -l);echo " $dll $np "|awk '{printf "%f\n",$2/$1}' >>output.txt
./vol -f "$file" --profile="${profiles[0]}" svcscan|grep 'Offset'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" svcscan|grep 'KERNEL_DRIVER'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" svcscan|grep 'OWN_PROCESS'|grep -v 'INTERACTIVE_PROCESS'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" svcscan|grep 'SHARE_PROCESS'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" svcscan|grep 'RUNNING'|wc -l>>output.txt
./vol -f "$file" --profile="${profiles[0]}" svcscan|grep 'INTERACTIVE_PROCESS'|wc -l>>output.txt
mv output.txt /home/ubuntu/volatility3
cd ..
cd volatility3
python3 vol.py -f "$file" windows.callbacks|tail -n +5|wc -l >>output.txt
python3 vol.py -f "$file" windows.callbacks|awk '$3 == "ntoskrnl" {print}'|wc -l>>output.txt
mv output.txt /home/ubuntu
cd ..
mv output.txt arr1.txt

